#!/usr/bin/env bash

d_flag=''
a_flag=''
n_flag=''

print_usage() {
    echo "Please provide an (-a)pp, a (-d)irectory, and a workspace (-n)umber. "
}

while getopts 'a:d:n:h' flag; do
  case "$flag" in
    a) a_flag="$OPTARG" ;;
    d) d_flag="$OPTARG" ;;
    n) n_flag="$OPTARG" ;;
    *) print_usage; exit 1 ;;
  esac
done

if [[ "$#" == 0 ]]; then
    print_usage
    exit 1
fi

side_window='1001 1202'
center_window='1668 1800'

browser () {
    firefox-developer-edition --new-window "https://calendar.google.com/calendar/u/0/r" & sleep 1.5
}

terminal () {
    dir=''
    case "$d_flag" in
        "eww") dir=".config/eww/";;
        "nvim") dir=".config/nvim/";;
        "vagari") dir="vagari/";;
        "media") dir="media/" ;;
        *) dir="dotfiles/" ;;
    esac
    kitty --working-directory="$HOME/$dir" & sleep 0.5
}

app () {
    case "$a_flag" in
        "gimp") gimp & sleep 5 ;;
        "inkscape") inkscape & sleep 5 ;;
        "web") browser ;;
        "discord") discord & sleep 5; hyprctl dispatch movefocus r;;
        *) firefox-developer-edition --new-window & sleep 1.5 ;;
    esac
}

online=1
connection () {
    nc -z 8.8.8.8 53  >/dev/null 2>&1
    online=$?
    echo "connect: $online"
}

while [[ "$online" -eq 1 ]]; do
    connection
    sleep 0.5
done

hyprctl keyword input:follow_mouse 0

pkill guvcview
hyprctl dispatch workspace "$n_flag"
terminal "$d_flag"
app
kitty --hold -o font_size=10.0 --title="cava" -c ".config/kitty/kitty.conf" -c ".config/kitty/nobg.conf" -e cava & sleep 0.5
hyprctl dispatch movefocus l
hyprctl dispatch resizeactive "exact $side_window"
hyprctl dispatch movefocus r
kitty --working-directory="$HOME/dotfiles/" & sleep 0.5
hyprctl dispatch movefocus l
hyprctl dispatch resizeactive "exact $center_window"
hyprctl dispatch movefocus r
kitty --title="invis" & sleep 0.5
hyprctl dispatch movefocus u
hyprctl dispatch resizeactive "exact $side_window"
guvcview & sleep 0.5
hyprctl dispatch movefocus r

hyprctl keyword input:follow_mouse 1
notify-send -t 2000 "layout $1 opened"

exit 0
