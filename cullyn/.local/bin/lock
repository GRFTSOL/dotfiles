#!/usr/bin/env bash

kill_background () {
    ps -ef | rg "$1" | rg -v rg | awk '{print $2}' | xargs kill
}

current_ws=$(tail -n 1 "/tmp/eww/workspace")
hyprctl dispatch workspace 6
killall eww -9
mpvpaper -o "--loop --brightness=3  --contrast=6  --saturation=-50  --hue=-8 --gamma=-20" "HDMI-A-1" ~/dotfiles/resources/videos/blackhole.webm & disown
sleep 0.75
kill_background "dna"

if [[ "$1" == "suspend" ]]; then
    systemctl suspend
    sleep 8
    systemctl suspend
fi

gdbus call -e -d de.mherzberg -o /de/mherzberg/wlrbrightness -m de.mherzberg.wlrbrightness.set 0.2
swaylock -C "$HOME/.config/swaylock/config.conf"
gdbus call -e -d de.mherzberg -o /de/mherzberg/wlrbrightness -m de.mherzberg.wlrbrightness.set 1
mpvpaper -o "--loop --brightness=6 --contrast=9 --saturation=-16 --hue=-24" "HDMI-A-1" ~/dotfiles/resources/videos/dna.mp4 &>/dev/null & disown
eval "$HOME/.local/bin/eww-open"
sleep 0.5
kill_background "blackhole"
hyprctl dispatch workspace "$current_ws"
notify-send "$current_ws"

exit 0
