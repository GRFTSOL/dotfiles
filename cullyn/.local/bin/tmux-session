#!/usr/bin/env bash

session_exists() {
    tmux has-session -t "$1" 2>/dev/null
}

new_window() {
    if [[ -z $4 ]]; then
        tmux new-window -da -t "$1" -n "$2" -c "$3"
    else
        tmux new-window -da -t "$1" -n "$2" -c "$3" "$4"
    fi
}

new_session() {
    if [[ -z $4 ]]; then
        tmux new-session -d -s "$1" -n "$2" -c "$3"
    else
        tmux new-session -d -s "$1" -n "$2" -c "$3" "$4"
    fi
}

restore() {
  tmux start-server
  local count=0
  local session=$HOME/.config/tmux/.tmux-session

    while read -r session_name window_name dir command; do
        if session_exists "$session_name"; then
            new_window "$session_name" "$window_name" "$dir" "$command"
        else
            new_session "$session_name" "$window_name" "$dir" "$command"
            count=$(( count + 1 ))
        fi
    done < "$session"

    notify-send tmux "$count sessions restored" -i "$HOME/dotfiles/resources/icons/tmux_icon.svg"
}

"$1"

exit 0
